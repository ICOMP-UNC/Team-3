<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CONVEYOR_BELT: include/speedometer.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CONVEYOR_BELT<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('speedometer_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">speedometer.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Speedometer module for measuring rotational speed in RPM and rad/s.
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;libopencm3/cm3/nvic.h&gt;</code><br />
<code>#include &lt;libopencm3/stm32/dma.h&gt;</code><br />
<code>#include &lt;libopencm3/stm32/exti.h&gt;</code><br />
<code>#include &lt;libopencm3/stm32/gpio.h&gt;</code><br />
<code>#include &lt;libopencm3/stm32/rcc.h&gt;</code><br />
<code>#include &lt;libopencm3/stm32/timer.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for speedometer.h:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h__incl.png" border="0" usemap="#ainclude_2speedometer_8h" alt=""/></div>
<map name="ainclude_2speedometer_8h" id="ainclude_2speedometer_8h">
<area shape="rect" title="Speedometer module for measuring rotational speed in RPM and rad/s." alt="" coords="476,5,628,32"/>
<area shape="rect" title=" " alt="" coords="5,80,161,107"/>
<area shape="poly" title=" " alt="" coords="476,34,176,80,175,75,475,29"/>
<area shape="rect" title=" " alt="" coords="185,80,352,107"/>
<area shape="poly" title=" " alt="" coords="504,35,334,78,332,73,502,30"/>
<area shape="rect" title=" " alt="" coords="376,80,539,107"/>
<area shape="poly" title=" " alt="" coords="537,35,488,73,484,68,534,30"/>
<area shape="rect" title=" " alt="" coords="564,80,730,107"/>
<area shape="poly" title=" " alt="" coords="570,30,620,68,617,73,567,35"/>
<area shape="rect" title=" " alt="" coords="755,80,915,107"/>
<area shape="poly" title=" " alt="" coords="602,30,771,73,770,78,601,35"/>
<area shape="rect" title=" " alt="" coords="939,80,1110,107"/>
<area shape="poly" title=" " alt="" coords="629,29,927,74,926,80,628,34"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h__dep__incl.png" border="0" usemap="#ainclude_2speedometer_8hdep" alt=""/></div>
<map name="ainclude_2speedometer_8hdep" id="ainclude_2speedometer_8hdep">
<area shape="rect" title="Speedometer module for measuring rotational speed in RPM and rad/s." alt="" coords="5,5,158,32"/>
<area shape="rect" href="speedometer_8c_source.html" title=" " alt="" coords="17,80,146,107"/>
<area shape="poly" title=" " alt="" coords="84,48,84,80,79,80,79,48"/>
</map>
</div>
</div>
<p><a href="speedometer_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aeddca74079a114fe1cd4e6bf8c1fa07f" id="r_aeddca74079a114fe1cd4e6bf8c1fa07f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeddca74079a114fe1cd4e6bf8c1fa07f">PULSES_1TURN</a>&#160;&#160;&#160;TIM_IC_PSC_8</td></tr>
<tr class="separator:aeddca74079a114fe1cd4e6bf8c1fa07f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa2076a38bdb2951dcf2c8b1f5cdef15" id="r_aaa2076a38bdb2951dcf2c8b1f5cdef15"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaa2076a38bdb2951dcf2c8b1f5cdef15">SPEEDOMETER_PIN</a>&#160;&#160;&#160;GPIO0</td></tr>
<tr class="separator:aaa2076a38bdb2951dcf2c8b1f5cdef15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7742d6ccedf0581d0ffc8440bcab91c" id="r_aa7742d6ccedf0581d0ffc8440bcab91c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa7742d6ccedf0581d0ffc8440bcab91c">SPEEDOMETER_PORT</a>&#160;&#160;&#160;GPIOA</td></tr>
<tr class="separator:aa7742d6ccedf0581d0ffc8440bcab91c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37ca298480303cd0b8208ee2424f6d73" id="r_a37ca298480303cd0b8208ee2424f6d73"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a37ca298480303cd0b8208ee2424f6d73">TENMS_TIMER</a>&#160;&#160;&#160;TIM1</td></tr>
<tr class="separator:a37ca298480303cd0b8208ee2424f6d73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0b1ece1ca505c960a07b6d092e2ae96" id="r_af0b1ece1ca505c960a07b6d092e2ae96"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af0b1ece1ca505c960a07b6d092e2ae96">ENCODER_TIMER</a>&#160;&#160;&#160;TIM2</td></tr>
<tr class="separator:af0b1ece1ca505c960a07b6d092e2ae96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79a77e3542b7dd60992b001d1385808c" id="r_a79a77e3542b7dd60992b001d1385808c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a79a77e3542b7dd60992b001d1385808c">DMA_CH</a>&#160;&#160;&#160;DMA_CHANNEL2</td></tr>
<tr class="separator:a79a77e3542b7dd60992b001d1385808c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b449068587ae73580d6a67a8c5603a6" id="r_a4b449068587ae73580d6a67a8c5603a6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4b449068587ae73580d6a67a8c5603a6">MS_PS</a>&#160;&#160;&#160;719</td></tr>
<tr class="separator:a4b449068587ae73580d6a67a8c5603a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1b40b2b64fe05a04914d25c6103aee9" id="r_aa1b40b2b64fe05a04914d25c6103aee9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa1b40b2b64fe05a04914d25c6103aee9">MS_INTERVAL</a>&#160;&#160;&#160;59999</td></tr>
<tr class="separator:aa1b40b2b64fe05a04914d25c6103aee9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76280054d0382c2564c6e50853fafd25" id="r_a76280054d0382c2564c6e50853fafd25"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a76280054d0382c2564c6e50853fafd25">CONSTANT_TO_RAD_S</a>&#160;&#160;&#160;1.309</td></tr>
<tr class="separator:a76280054d0382c2564c6e50853fafd25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b6ba6e44eb60600214e88f4b2e69c16" id="r_a0b6ba6e44eb60600214e88f4b2e69c16"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0b6ba6e44eb60600214e88f4b2e69c16">CONSTANT_TO_RPM</a>&#160;&#160;&#160;12.5</td></tr>
<tr class="separator:a0b6ba6e44eb60600214e88f4b2e69c16"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7a70891a4b191f51d77094791a647b05" id="r_a7a70891a4b191f51d77094791a647b05"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7a70891a4b191f51d77094791a647b05">speedometer_init</a> (void)</td></tr>
<tr class="memdesc:a7a70891a4b191f51d77094791a647b05"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the speedometer module.  <br /></td></tr>
<tr class="separator:a7a70891a4b191f51d77094791a647b05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeefd790f68f5e4c91cfa4ef56e2e898e" id="r_aeefd790f68f5e4c91cfa4ef56e2e898e"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeefd790f68f5e4c91cfa4ef56e2e898e">speedometer_getRPM</a> (void)</td></tr>
<tr class="memdesc:aeefd790f68f5e4c91cfa4ef56e2e898e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the current speed in revolutions per minute (RPM).  <br /></td></tr>
<tr class="separator:aeefd790f68f5e4c91cfa4ef56e2e898e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af16749f3ab099e15f86d2d3a50794176" id="r_af16749f3ab099e15f86d2d3a50794176"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af16749f3ab099e15f86d2d3a50794176">speedometer_getRAD_S</a> (void)</td></tr>
<tr class="memdesc:af16749f3ab099e15f86d2d3a50794176"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the current speed in radians per second (rad/s).  <br /></td></tr>
<tr class="separator:af16749f3ab099e15f86d2d3a50794176"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Speedometer module for measuring rotational speed in RPM and rad/s. </p>
<p>This module provides functions to initialize a speedometer using an encoder connected to TIM2 as an external clock, and functions to retrieve the RPM and radian-per-second (rad/s) values. It configures the required timers and DMA to calculate rotational speed based on encoder pulses. </p>

<p class="definition">Definition in file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a76280054d0382c2564c6e50853fafd25" name="a76280054d0382c2564c6e50853fafd25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76280054d0382c2564c6e50853fafd25">&#9670;&#160;</a></span>CONSTANT_TO_RAD_S</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONSTANT_TO_RAD_S&#160;&#160;&#160;1.309</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constant to convert encoder counts to radian per second (rad/s). </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00043">43</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00080">speedometer_getRAD_S()</a>.</p>

</div>
</div>
<a id="a0b6ba6e44eb60600214e88f4b2e69c16" name="a0b6ba6e44eb60600214e88f4b2e69c16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b6ba6e44eb60600214e88f4b2e69c16">&#9670;&#160;</a></span>CONSTANT_TO_RPM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONSTANT_TO_RPM&#160;&#160;&#160;12.5</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constant to convert encoder counts to revolutions per minute (RPM). </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00046">46</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00072">speedometer_getRPM()</a>.</p>

</div>
</div>
<a id="a79a77e3542b7dd60992b001d1385808c" name="a79a77e3542b7dd60992b001d1385808c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79a77e3542b7dd60992b001d1385808c">&#9670;&#160;</a></span>DMA_CH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DMA_CH&#160;&#160;&#160;DMA_CHANNEL2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>DMA channel used for transferring data in speedometer operations. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00034">34</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<a id="af0b1ece1ca505c960a07b6d092e2ae96" name="af0b1ece1ca505c960a07b6d092e2ae96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0b1ece1ca505c960a07b6d092e2ae96">&#9670;&#160;</a></span>ENCODER_TIMER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ENCODER_TIMER&#160;&#160;&#160;TIM2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Timer configured as an encoder timer for measuring rotational speed. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00031">31</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<a id="aa1b40b2b64fe05a04914d25c6103aee9" name="aa1b40b2b64fe05a04914d25c6103aee9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1b40b2b64fe05a04914d25c6103aee9">&#9670;&#160;</a></span>MS_INTERVAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MS_INTERVAL&#160;&#160;&#160;59999</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Timer update interval for measuring rotation, set to 600 ms. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00040">40</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<a id="a4b449068587ae73580d6a67a8c5603a6" name="a4b449068587ae73580d6a67a8c5603a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b449068587ae73580d6a67a8c5603a6">&#9670;&#160;</a></span>MS_PS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MS_PS&#160;&#160;&#160;719</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prescaler value for generating a 600 ms interval, used with TENMS_TIMER. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00037">37</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<a id="aeddca74079a114fe1cd4e6bf8c1fa07f" name="aeddca74079a114fe1cd4e6bf8c1fa07f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeddca74079a114fe1cd4e6bf8c1fa07f">&#9670;&#160;</a></span>PULSES_1TURN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PULSES_1TURN&#160;&#160;&#160;TIM_IC_PSC_8</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>High pulse count for one full rotation, defines encoder resolution. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00019">19</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

</div>
</div>
<a id="aaa2076a38bdb2951dcf2c8b1f5cdef15" name="aaa2076a38bdb2951dcf2c8b1f5cdef15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa2076a38bdb2951dcf2c8b1f5cdef15">&#9670;&#160;</a></span>SPEEDOMETER_PIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPEEDOMETER_PIN&#160;&#160;&#160;GPIO0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>GPIO pin connected to the speedometer sensor. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00022">22</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<a id="aa7742d6ccedf0581d0ffc8440bcab91c" name="aa7742d6ccedf0581d0ffc8440bcab91c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7742d6ccedf0581d0ffc8440bcab91c">&#9670;&#160;</a></span>SPEEDOMETER_PORT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPEEDOMETER_PORT&#160;&#160;&#160;GPIOA</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>GPIO port connected to the speedometer sensor. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00025">25</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<a id="a37ca298480303cd0b8208ee2424f6d73" name="a37ca298480303cd0b8208ee2424f6d73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37ca298480303cd0b8208ee2424f6d73">&#9670;&#160;</a></span>TENMS_TIMER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TENMS_TIMER&#160;&#160;&#160;TIM1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Timer used to measure intervals in milliseconds for speed calculation. </p>

<p class="definition">Definition at line <a class="el" href="speedometer_8h_source.html#l00028">28</a> of file <a class="el" href="speedometer_8h_source.html">speedometer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af16749f3ab099e15f86d2d3a50794176" name="af16749f3ab099e15f86d2d3a50794176"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af16749f3ab099e15f86d2d3a50794176">&#9670;&#160;</a></span>speedometer_getRAD_S()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float speedometer_getRAD_S </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the current speed in radians per second (rad/s). </p>
<p>Uses the pulse count from the encoder to calculate speed in rad/s. This function provides a measure of rotational speed in radians per second, useful for precise control calculations.</p>
<dl class="section return"><dt>Returns</dt><dd>The current speed in radians per second (rad/s).</dd></dl>
<p>Calculate and return the speed in radians per second based on encoder turns </p>
<p>Convert turns to rad/s</p>

<p class="definition">Definition at line <a class="el" href="speedometer_8c_source.html#l00080">80</a> of file <a class="el" href="speedometer_8c_source.html">speedometer.c</a>.</p>

<p class="reference">References <a class="el" href="speedometer_8h_source.html#l00043">CONSTANT_TO_RAD_S</a>, and <a class="el" href="speedometer_8c_source.html#l00080">speedometer_getRAD_S()</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00080">speedometer_getRAD_S()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h_af16749f3ab099e15f86d2d3a50794176_cgraph.png" border="0" usemap="#aspeedometer_8h_af16749f3ab099e15f86d2d3a50794176_cgraph" alt=""/></div>
<map name="aspeedometer_8h_af16749f3ab099e15f86d2d3a50794176_cgraph" id="aspeedometer_8h_af16749f3ab099e15f86d2d3a50794176_cgraph">
<area shape="rect" title="Gets the current speed in radians per second (rad/s)." alt="" coords="5,29,172,56"/>
<area shape="poly" title=" " alt="" coords="60,30,55,21,58,11,70,5,89,3,109,5,119,12,116,16,107,10,88,8,71,10,62,15,60,20,64,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h_af16749f3ab099e15f86d2d3a50794176_icgraph.png" border="0" usemap="#aspeedometer_8h_af16749f3ab099e15f86d2d3a50794176_icgraph" alt=""/></div>
<map name="aspeedometer_8h_af16749f3ab099e15f86d2d3a50794176_icgraph" id="aspeedometer_8h_af16749f3ab099e15f86d2d3a50794176_icgraph">
<area shape="rect" title="Gets the current speed in radians per second (rad/s)." alt="" coords="5,29,172,56"/>
<area shape="poly" title=" " alt="" coords="116,16,107,10,88,8,71,10,62,15,60,20,64,28,60,30,55,21,58,11,70,5,89,3,109,5,119,12"/>
</map>
</div>

</div>
</div>
<a id="aeefd790f68f5e4c91cfa4ef56e2e898e" name="aeefd790f68f5e4c91cfa4ef56e2e898e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeefd790f68f5e4c91cfa4ef56e2e898e">&#9670;&#160;</a></span>speedometer_getRPM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float speedometer_getRPM </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the current speed in revolutions per minute (RPM). </p>
<p>Reads the pulse count from the encoder and calculates the speed in RPM based on the predefined constants. This function converts pulse data into a standard RPM measurement.</p>
<dl class="section return"><dt>Returns</dt><dd>The current speed in RPM.</dd></dl>
<p>Calculate and return the speed in RPM based on encoder turns </p>
<p>Convert turns to RPM</p>

<p class="definition">Definition at line <a class="el" href="speedometer_8c_source.html#l00072">72</a> of file <a class="el" href="speedometer_8c_source.html">speedometer.c</a>.</p>

<p class="reference">References <a class="el" href="speedometer_8h_source.html#l00046">CONSTANT_TO_RPM</a>, and <a class="el" href="speedometer_8c_source.html#l00072">speedometer_getRPM()</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00072">speedometer_getRPM()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_cgraph.png" border="0" usemap="#aspeedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_cgraph" alt=""/></div>
<map name="aspeedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_cgraph" id="aspeedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_cgraph">
<area shape="rect" title="Gets the current speed in revolutions per minute (RPM)." alt="" coords="5,29,157,56"/>
<area shape="poly" title=" " alt="" coords="55,30,50,21,53,11,64,5,81,3,99,5,109,12,106,16,98,10,81,8,66,10,57,14,55,20,59,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_icgraph.png" border="0" usemap="#aspeedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_icgraph" alt=""/></div>
<map name="aspeedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_icgraph" id="aspeedometer_8h_aeefd790f68f5e4c91cfa4ef56e2e898e_icgraph">
<area shape="rect" title="Gets the current speed in revolutions per minute (RPM)." alt="" coords="5,29,157,56"/>
<area shape="poly" title=" " alt="" coords="106,16,98,10,81,8,66,10,57,14,55,20,59,28,55,30,50,21,53,11,64,5,81,3,99,5,109,12"/>
</map>
</div>

</div>
</div>
<a id="a7a70891a4b191f51d77094791a647b05" name="a7a70891a4b191f51d77094791a647b05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a70891a4b191f51d77094791a647b05">&#9670;&#160;</a></span>speedometer_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void speedometer_init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the speedometer module. </p>
<p>Configures the necessary peripherals, including the encoder timer (TIM2), the control timer (TIM1), and the DMA channel used for data transfer. Sets up the speedometer GPIO as an input and enables external clocking on TIM2 to measure rotational speed based on encoder pulses.</p>
<p>Variable to store the number of encoder turns Initialize the speedometer by configuring timers, DMA, and GPIO </p>
<p>Enable clocks for DMA1, TIM2 (encoder timer), TIM1 (timer for measurements), and GPIOA</p>
<p>Configure speedometer GPIO pin as floating input</p>
<p>Configure TIM2 as an external clock source for the encoder</p>
<p>Set timer to external clock mode</p>
<p>Use an external trigger as the source</p>
<p>Trigger on rising edges</p>
<p>Set filter to reduce noise</p>
<p>Configure TIM1 (TENMS_TIMER) to generate periodic DMA requests</p>
<p>Set prescaler to adjust timer clock speed</p>
<p>Set timer period to 600ms</p>
<p>Set output compare value</p>
<p>Freeze output when counter reaches OC1 value</p>
<p>Enable DMA request on update events</p>
<p>Configure DMA1 Channel for reading TIM2 counter (encoder position)</p>
<p>Reset DMA channel to clear previous configuration</p>
<p>Set high priority for DMA transfers</p>
<p>Set DMA source to TIM2 counter register</p>
<p>Set DMA destination to <code>turns</code> variable</p>
<p>Transfer a single data item per request</p>
<p>Set peripheral data size to 16 bits</p>
<p>Set memory data size to 16 bits</p>
<p>Enable circular mode for continuous updates</p>
<p>Enable transfer complete interrupt to reset TIM2 counter after each DMA transfer</p>
<p>Enable interrupt on transfer completion</p>
<p>Enable NVIC interrupt for DMA channel 2</p>
<p>Start the DMA channel</p>
<p>Enable all counters to begin measurements</p>
<p>Start TIM2 (encoder timer)</p>
<p>Start TIM1 (measurement timer)</p>

<p class="definition">Definition at line <a class="el" href="speedometer_8c_source.html#l00008">8</a> of file <a class="el" href="speedometer_8c_source.html">speedometer.c</a>.</p>

<p class="reference">References <a class="el" href="speedometer_8h_source.html#l00034">DMA_CH</a>, <a class="el" href="speedometer_8h_source.html#l00031">ENCODER_TIMER</a>, <a class="el" href="speedometer_8h_source.html#l00040">MS_INTERVAL</a>, <a class="el" href="speedometer_8h_source.html#l00037">MS_PS</a>, <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>, <a class="el" href="speedometer_8h_source.html#l00022">SPEEDOMETER_PIN</a>, <a class="el" href="speedometer_8h_source.html#l00025">SPEEDOMETER_PORT</a>, and <a class="el" href="speedometer_8h_source.html#l00028">TENMS_TIMER</a>.</p>

<p class="reference">Referenced by <a class="el" href="speedometer_8c_source.html#l00008">speedometer_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h_a7a70891a4b191f51d77094791a647b05_cgraph.png" border="0" usemap="#aspeedometer_8h_a7a70891a4b191f51d77094791a647b05_cgraph" alt=""/></div>
<map name="aspeedometer_8h_a7a70891a4b191f51d77094791a647b05_cgraph" id="aspeedometer_8h_a7a70891a4b191f51d77094791a647b05_cgraph">
<area shape="rect" title="Initializes the speedometer module." alt="" coords="5,29,126,56"/>
<area shape="poly" title=" " alt="" coords="44,30,40,20,43,11,52,5,66,3,81,5,89,12,85,16,78,10,65,8,54,10,47,14,46,20,49,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="speedometer_8h_a7a70891a4b191f51d77094791a647b05_icgraph.png" border="0" usemap="#aspeedometer_8h_a7a70891a4b191f51d77094791a647b05_icgraph" alt=""/></div>
<map name="aspeedometer_8h_a7a70891a4b191f51d77094791a647b05_icgraph" id="aspeedometer_8h_a7a70891a4b191f51d77094791a647b05_icgraph">
<area shape="rect" title="Initializes the speedometer module." alt="" coords="5,29,126,56"/>
<area shape="poly" title=" " alt="" coords="85,16,78,10,65,8,54,10,47,14,46,20,49,28,44,30,40,20,43,11,52,5,66,3,81,5,89,12"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="speedometer_8h.html">speedometer.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
